<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="styles.css">

</head>
<body>
    
    <div class="container">
        <!-- top banner -->
        <div class="top-banner show">
            <p>Free Shipping on Orders Over PKR 5000</p>
            <!-- close -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-icon lucide-x close"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </div>

        <!-- menu -->
     <div class="menu">
        <ul>
            <li>
                <a href="#">Sweaters</a>
                <a href="#">Bottoms</a>
                <a href="#">Hoodies</a>
            </li>
            <li>
                <a href="../wad-project/index.html" title="view-cart"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-bag-icon lucide-shopping-bag"><path d="M16 10a4 4 0 0 1-8 0"/><path d="M3.103 6.034h17.794"/><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"/></svg>
                Cart</a>
                <!-- <a href="../pages/Login.html" title="Login"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-round-icon lucide-user-round"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 0 0-16 0"/></svg>
                Login</a> -->
            </li>
        </ul>
     </div>

     <div class="shop-menu-mobile-version">
        <div class="shop-menu" title="menu">SHOP</div>
     </div>

        <!-- navbar -->
        <nav>
            <ul>
                <li class="shop-menu hide-on-mobile-screen">SHOP</li>
                <li><a href="../homepage.html">LOGO</a></li>
                <li>
                    <a href="#" title="search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg></a>
    
                    <a href="../pages/Login.html" title="Login" class="hide-on-mobile-screen" id="user-profile">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-round-icon lucide-user-round"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 0 0-16 0"/></svg>
                        <div class="loggedInUserInfo">
                            <div><strong>Account Id: </strong> <p class="account-id"></p></div>
                            <div><strong>Username: </strong> <p class="account-username"></p></div>
                            <a href="/public/admin/dashboard.html" class="admin-dashboard-button">Admin Dashboard</a>
                            <button class="logout_user">Logout</button>
                        </div>
                    </a>
    
                    <a href="../wad-project/index.html" title="view-cart"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-bag-icon lucide-shopping-bag"><path d="M16 10a4 4 0 0 1-8 0"/><path d="M3.103 6.034h17.794"/><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"/></svg></a>
                </li>
            </ul>
        </nav>

        <div class="search-overlay">
            <div class="search-bar">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
                <input type="text" style="padding-inline: 10px;" placeholder="SEARCH PRODUCTS" class="inp">
            </div>
        </div>
        <p class="search-text">
        </p>

        <!-- main data container -->
        <div class="display-results">
            <div class="temp-display">
                <p>Type your query and press Enter to search products.</p>
            </div>
        </div>
    
        <!-- <div class="lower-btn">
            <button type="button" class="loadmore" disabled>
                Load More
            </button>
        </div> -->

         <!-- footer -->
    <footer class="footer">
            <div class="footer-section">
                <h4>ABOUT US</h4>
                <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Aperiam exercitationem expedita sint dicta veniam iusto voluptatem provident corporis assumenda cum, hic beatae ab. Cupiditate repudiandae ipsa aspernatur ad, ullam distinctio.</p>
            </div>
            <div class="footer-section">
                <h4>QUICK LINKS</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Faq's</a></li>
                    <li><a href="#">Exchange & returns</a></li>
                    <li><a href="#">Shipping Policy</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Track Your Order</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>FIND US ON</h4>
                <ul class="social-media">
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="#">Whatsapp</a></li>
                </ul>
            </div>
            <div class="footer-section footer-bottom">
                &copy; 2025 BRANDNAME.
            </div>
        </footer>
    </div>
    <script>

        let displayResults = document.querySelector(".display-results"); // main container to display results 

        // search product function
        async function searchProduct(q="Hoodies", isLoadMore=false){
            const API_URL = `/api/products/search?q=${q}`;
            try {
                // fetch data from server
                const res = await fetch(API_URL);
                if(!res.ok) {
                    console.log("no results found");
                } 
                const data = await res.json()

                // handle no results found
                if(!Array.isArray(data.searchResults) || data.searchResults.length === 0){
                    console.log(data.message)
                    document.querySelector(".search-text").innerHTML = `NO RESULTS FOUND FOR: <strong>${q}</strong>`;
                    return;
                }

                // console.log(data.searchResults);

                document.querySelector(".search-text").innerHTML = `RESULTS FOR: <strong>${q}</strong>`;
                let collector = "";

                // r = result
                // build html for each product
                data.searchResults.map(r => 
                    collector += `
                    <div class="item" data-product-id="${r._id}">
                        <img data-src="${r.image?.url}" src="" alt="${r.name}" />
                        ${ r.isNewArrival ? "<h4 style='color: red;'>New Arrival</h4>" :    "" }
                        <h4>${r.name}</h4>
                        <p class="webkit-box"><strong>Description:</strong> ${r.description}</p>
                        <p><strong>Type:</strong> ${r.productType}</p>
                        <p><strong>InStock:</strong> <span class="inStock">${r.quantity}<span></p>
                        <p><strong>Size:</strong> ${r.size}</p>
                        <p><strong>Colors:</strong> ${r.color}</p>
                        <p><strong>Price:</strong> ${r.price} PKR</p>
                    </div>
                    `
                );
                
                // insert into DOM
                displayResults.innerHTML = collector;
                
                // a little scroll effect to add images loading smoothly
                window.scrollTo({
                    top: 2,
                    left: 0,
                    behavior: 'smooth'
                })

            } catch (error) {
                console.error("Error while searching products", error);
                alert("Sorry, products were not found due to server error, we are fixing the issue, please try again later.");
            } finally {
                // add to cart logic
                setupAddToCartButtons();
            }
        }
        
        let queryInput = "";
        // search once enter key is pressed
        window.addEventListener("keydown", (e)=>{
            if (e.key === "Enter" && e.target.value.trim()) {
                queryInput = e.target.value.trim();
                searchProduct(queryInput);
            }
        });

        // handle cart logic
        function setupAddToCartButtons(){
            console.log("Setting up add to cart buttons...");
        }

    </script>
    <script src="../global.js"></script>
    <script src="../app.js" defer></script>
    <script src="../handleTopBanner.js" defer></script>
</body>
</html>